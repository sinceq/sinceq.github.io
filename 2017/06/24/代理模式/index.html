<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="design patterns,java," />










<meta name="description" content="代理模式我们买房子或者租房子，我们可以自己去找房源，也可以通过房屋中介来完成。 意图：为其他对象提供一种代理以控制对这个对象的访问。 动机：对一个对象进行访问控制的一个原因是为了只有在我们确实需要这个对象时才对它进行创建和初始化。 参与者 Proxy 保存一个引用使得代理可以访问实体。如RealSubject和Subject的接口相同，Proxy会引用Subject。 提供一个与Subject的接">
<meta name="keywords" content="design patterns,java">
<meta property="og:type" content="article">
<meta property="og:title" content="代理模式">
<meta property="og:url" content="http://sinceq.com/2017/06/24/代理模式/index.html">
<meta property="og:site_name" content="1llusion">
<meta property="og:description" content="代理模式我们买房子或者租房子，我们可以自己去找房源，也可以通过房屋中介来完成。 意图：为其他对象提供一种代理以控制对这个对象的访问。 动机：对一个对象进行访问控制的一个原因是为了只有在我们确实需要这个对象时才对它进行创建和初始化。 参与者 Proxy 保存一个引用使得代理可以访问实体。如RealSubject和Subject的接口相同，Proxy会引用Subject。 提供一个与Subject的接">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-07-11T18:06:19.518Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="代理模式">
<meta name="twitter:description" content="代理模式我们买房子或者租房子，我们可以自己去找房源，也可以通过房屋中介来完成。 意图：为其他对象提供一种代理以控制对这个对象的访问。 动机：对一个对象进行访问控制的一个原因是为了只有在我们确实需要这个对象时才对它进行创建和初始化。 参与者 Proxy 保存一个引用使得代理可以访问实体。如RealSubject和Subject的接口相同，Proxy会引用Subject。 提供一个与Subject的接">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://sinceq.com/2017/06/24/代理模式/"/>





  <title>代理模式 | 1llusion</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-116144054-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?6a5ae1f5c5c7844b2dba26e66383316b";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">1llusion</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://sinceq.com/2017/06/24/代理模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="一">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="1llusion">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">代理模式</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-24T16:40:06+08:00">
                2017-06-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/设计模式/" itemprop="url" rel="index">
                    <span itemprop="name">设计模式</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/06/24/代理模式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/06/24/代理模式/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h3><p>我们买房子或者租房子，我们可以自己去找房源，也可以通过房屋中介来完成。</p>
<p>意图：为其他对象提供一种代理以控制对这个对象的访问。</p>
<p>动机：对一个对象进行访问控制的一个原因是为了只有在我们确实需要这个对象时才对它进行创建和初始化。</p>
<h4 id="参与者"><a href="#参与者" class="headerlink" title="参与者"></a>参与者</h4><ul>
<li><p><strong>Proxy</strong></p>
<p>保存一个引用使得代理可以访问实体。如RealSubject和Subject的接口相同，Proxy会引用Subject。</p>
<p>提供一个与Subject的接口相同的接口，这样代理就可以来替代实体。</p>
<p>控制对实体的存取，并可能负责创建和删除它。</p>
<p>其他功能依赖于代理的类型：</p>
<ul>
<li>Remote Proxy负责对请求及其参数进行编码，并向不同地址空间中的实体发送已编码的请求。</li>
<li>Virtual Proxy可以缓存实体的附加信息，以便延迟对它的访问。</li>
<li>Protection Proxy检查调用者是否具有实现一个请求所必须的访问权限</li>
</ul>
</li>
<li><p><strong>Subject</strong></p>
<p>定义RealSubject和Proxy的共用接口，这样就在任何使用RealSubject的地方都可以使用Proxy。</p>
</li>
<li><p><strong>Real Subject</strong></p>
<p>定义Proxy 所代表的实体。</p>
</li>
</ul>
<a id="more"></a>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><p>按照代理创建的时期来进行分类的话，可以分为两种：静态代理、动态代理。</p>
<h4 id="静态代理"><a href="#静态代理" class="headerlink" title="静态代理"></a>静态代理</h4><p>Proxy.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#ifndef _PROXY_H</span><br><span class="line">#define _PROXY_H</span><br><span class="line"></span><br><span class="line">class Subject</span><br><span class="line">&#123;</span><br><span class="line">    public:</span><br><span class="line">        Subject() &#123;&#125;</span><br><span class="line">        virtual ~Subject()&#123;&#125;;</span><br><span class="line">        virtual void request() = 0;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">class RealSubject: public Subject</span><br><span class="line">&#123;</span><br><span class="line">    public:</span><br><span class="line">        RealSubject();</span><br><span class="line">        virtual ~RealSubject();</span><br><span class="line">        virtual void request();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">class Proxy: public Subject</span><br><span class="line">&#123;</span><br><span class="line">    public:</span><br><span class="line">        Proxy();</span><br><span class="line">        virtual ~Proxy();</span><br><span class="line">        virtual void request();</span><br><span class="line"></span><br><span class="line">    private:</span><br><span class="line">        RealSubject* realSubject;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">#endif</span><br></pre></td></tr></table></figure>
<p>Proxy.cpp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;Proxy.h&quot;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">RealSubject::RealSubject()</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; &quot;RealSubject constructor&quot; &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">RealSubject::~RealSubject()</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; &quot;RealSubject destructor&quot; &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void RealSubject::request()</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; &quot;RealSubject request&quot; &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Proxy::Proxy(): realSubject(NULL)</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; &quot;Proxy constructor&quot; &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Proxy::~Proxy()</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; &quot;Proxy destructor&quot; &lt;&lt; endl;</span><br><span class="line">    delete realSubject;</span><br><span class="line">    realSubject = NULL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Proxy::request()</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; &quot;Proxy request&quot; &lt;&lt; endl;</span><br><span class="line">    if (!realSubject) &#123;</span><br><span class="line">        realSubject = new RealSubject();</span><br><span class="line">    &#125;</span><br><span class="line">    realSubject-&gt;request();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Main.cpp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;Proxy.h&quot;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    Subject* proxy = new Proxy();</span><br><span class="line">    proxy-&gt;request();</span><br><span class="line"></span><br><span class="line">    delete proxy;</span><br><span class="line">    proxy = NULL;</span><br><span class="line">    </span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Output</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Proxy constructor</span><br><span class="line">Proxy request</span><br><span class="line">RealSubject constructor</span><br><span class="line">RealSubject request</span><br><span class="line">Proxy destructor</span><br><span class="line">RealSubject destructor</span><br></pre></td></tr></table></figure>
<p>Java example</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public interface IShape &#123;</span><br><span class="line">    void draw();</span><br><span class="line">    double area();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public class Circle implements IShape &#123;</span><br><span class="line">    private int radius;</span><br><span class="line">    </span><br><span class="line">    Circle(int r) &#123;</span><br><span class="line">        radius = r;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void draw() &#123;</span><br><span class="line">        System.out.println(&quot;Draw Circle&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public double area()&#123;</span><br><span class="line">        return Math.PI * radius * radius;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public class ShapeProxy implements IShape &#123;</span><br><span class="line">    private IShape shape;</span><br><span class="line">    public ShapeProxy(IShape shape)</span><br><span class="line">    &#123;</span><br><span class="line">        this.shape = shape;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void draw() &#123;</span><br><span class="line">        shape.draw();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public double area() &#123;</span><br><span class="line">        return shape.area();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h4><p>静态代理会随着业务庞大导致方法数量越来越多，代理类的代码量就会变得十分庞大。所以引入了动态代理来解决此类问题。</p>
<blockquote>
<ul>
<li>Java 1.3 supports the creation of dynamic proxy classes and instances </li>
<li>A dynamic proxy class is a class that implements a list of interfaces specified at runtime when the class is created </li>
<li>A proxy interface is an interface that is implemented by a proxy class </li>
<li>A proxy instance is an instance of a proxy class </li>
<li>Each proxy instance has an associated invocation handler object, which implements the interface InvocationHandler</li>
<li>A method invocation on a proxy instance through one of its proxy interfaces will be dispatched to the invoke() method of the instance’s invocation handler</li>
<li>Proxy classes are created using the new java.lang.reflect.Proxy class</li>
<li>Proxy classes are public, final, non-abstract subclasses of java.lang.reflect.Proxy</li>
<li>The unqualified name of a proxy class is unspecified. The space of class names that begin with the string “$Proxy” should be, however, reserved for proxy classes. </li>
<li>A proxy class implements exactly the interfaces specified at its creation l Since a proxy class implements all of the interfaces specified at its creation, invoking getInterfaces() on its Class object will return an array containing the same list of interfaces (in the order specified at its creation)</li>
<li>Each proxy class has one public constructor that takes one argument, an implementation of the interface InvocationHandler, to set the invocation handler for a proxy instance</li>
<li>Rather than having to use the reflection API to access the public constructor, a proxy instance can be also be created by calling the Proxy.newInstance() method, which combines the actions of calling Proxy.getProxyClass() with invoking the constructor with an invocation handler</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class ShapeHandler implements InvocationHandler &#123;</span><br><span class="line">    private IShape shape;</span><br><span class="line"></span><br><span class="line">    public ShapeHandler(IShape shape)&#123;</span><br><span class="line">        this.shape = shape;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;</span><br><span class="line">        return method.invoke(shape, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        IShape circle = new Circle(5);</span><br><span class="line">        ClassLoader cl = IShape.class.getClassLoader();</span><br><span class="line">        IShape shape = (IShape) Proxy.newProxyInstance(cl, new Class[]&#123;IShape.class&#125;, new ShapeHandler(circle));</span><br><span class="line">        shape.draw();</span><br><span class="line">        System.out.println(shape.area());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="JDKProxy-vs-CGLIB"><a href="#JDKProxy-vs-CGLIB" class="headerlink" title="JDKProxy vs. CGLIB"></a>JDKProxy vs. CGLIB</h4><h5 id="Java-Proxy"><a href="#Java-Proxy" class="headerlink" title="Java Proxy"></a>Java Proxy</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public static Object newProxyInstance(ClassLoader loader,</span><br><span class="line"> Class[] interfaces,</span><br><span class="line"> InvocationHandler ih)</span><br><span class="line"> throws IllegalArgumentException</span><br><span class="line"> </span><br><span class="line">public static InvocationHandler getInvocationHandler</span><br><span class="line">(Object proxy)</span><br><span class="line">throws IllegalArgumentException</span><br><span class="line"></span><br><span class="line">public Object invoke(Object proxy, Method method,</span><br><span class="line"> Object[] args) throws Throwable</span><br></pre></td></tr></table></figure>
<p>关键方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public static Object newProxyInstance(ClassLoader loader,</span><br><span class="line">                                        Class&lt;?&gt;[] interfaces,</span><br><span class="line">                                        InvocationHandler h)</span><br><span class="line">      throws IllegalArgumentException</span><br></pre></td></tr></table></figure>
<p>该方法会根据指定的参数动态创建代理对象，三个参数的意义如下：</p>
<ol>
<li>loader  指定代理对象的类加载器</li>
<li>interfaces 代理对象需要实现的接口，可以同时指定多个接口</li>
<li>handler 方法调用的实际处理者，代理对象的方法调用都会转发到这里。</li>
</ol>
<p><strong>newProxyInstance()</strong> 会返回一个实现了指定接口的代理对象，对该对象的所有方法调用都会转发给InvocationHandler.invoke()方法。</p>
<p>Java动态代理是基于接口的，如果对象没有实现接口的话我们就要使用Cglib了。</p>
<h5 id="CGLOB-Code-Generation-Library"><a href="#CGLOB-Code-Generation-Library" class="headerlink" title="CGLOB(Code Generation Library)"></a>CGLOB(Code Generation Library)</h5><p>CGLIB是基于ASM的字节码生成库，它允许我们在运行时对字节码进行修改和动态生成。</p>
<p><strong>CGLIB通过继承方式实现代理。</strong></p>
<p>通过CGLIB代理实现如下：</p>
<ol>
<li>首先要实现一个MethodInterceptor，方法调用会被转发到该类的intercept()方法。</li>
<li>在需要使用类的时候，通过CGLIB动态代理获取代理对象。</li>
</ol>
<p><strong>JDK原生动态代理是Java原生支持的，不需要任何外部依赖，但是只能基于接口进行代理；</strong></p>
<p><strong>CGLIB通过继承的方法进行代理，无论目标对象有没有实现接口都可以代理，但是无法处理final的情况。</strong></p>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><p>如果已有的方法在使用的时候需要对原有的方法进行改进，此时有两种方法：</p>
<ol>
<li>修改原有的方法来适应。这样违反了“对扩展开放，对修改关闭”的原则。</li>
<li>就是采用一个代理类调用原有的方法，且对产生的结果进行控制。这种方法就是代理模式。</li>
</ol>
<p>使用代理模式，可以将功能划分的更加清晰，有助于后期维护！</p>
<h4 id="常见情况"><a href="#常见情况" class="headerlink" title="常见情况"></a>常见情况</h4><h5 id="远程代理（Remote-Proxy）"><a href="#远程代理（Remote-Proxy）" class="headerlink" title="远程代理（Remote Proxy）"></a>远程代理（Remote Proxy）</h5><p>为一个对象在不同的地址空间提供局部代表。<strong>使得客户端程序可以访问在远程主机上的对象</strong>。</p>
<p><strong>可以将网络的细节隐藏起来，使得客户端不必考虑网络的存在</strong>。</p>
<h5 id="虚代理（Virtual-Proxy）"><a href="#虚代理（Virtual-Proxy）" class="headerlink" title="虚代理（Virtual Proxy）"></a>虚代理（Virtual Proxy）</h5><p>根据需要创建开销很大的对象。</p>
<p>通常，以下两种情况下可以考虑使用虚拟代理：</p>
<ol>
<li>由于对象本身的复杂性或者网络等原因导致一个对象需要较长的加载时间，此时可以用一个加载时间相对较短的代理对象来代表真是对象。</li>
<li>当一个对象的加载十分耗费系统资源的时候，也非常适合使用虚拟代理。</li>
</ol>
<h5 id="保护代理（Protection-Proxy）"><a href="#保护代理（Protection-Proxy）" class="headerlink" title="保护代理（Protection Proxy）"></a>保护代理（Protection Proxy）</h5><p>控制对原始对象的访问。保护代理用于对象应该有不同的访问权限的时候。</p>
<h5 id="智能指引（Smart-Reference）"><a href="#智能指引（Smart-Reference）" class="headerlink" title="智能指引（Smart Reference）"></a>智能指引（Smart Reference）</h5><p>取代了简单的指针，它在访问对象时执行一些附加操作。它的典型用途包括：</p>
<ul>
<li>对指向实际对象的引用计数，这样当该对象没有引用时，可以自动释放它。</li>
<li>当第一次引用一个持久对象时，将它装入内存。</li>
<li>在访问一个控制对象前，检查是否已经锁定了它，以确保其他对象不能改变它。</li>
</ul>
<h5 id="缓冲代理（Cache-Proxy）"><a href="#缓冲代理（Cache-Proxy）" class="headerlink" title="缓冲代理（Cache Proxy）"></a>缓冲代理（Cache Proxy）</h5><p>缓冲代理为某一个操作的结果提供临时的缓存存储空间，以便在后续使用中能够共享这些结果，从而可以避免某些方法的重复执行，优化系统性能。</p>
<h4 id="Spring-AOP"><a href="#Spring-AOP" class="headerlink" title="Spring AOP"></a>Spring AOP</h4><p>动态代理是Spring AOP的实现方法。</p>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p><a href="https://www.zhihu.com/question/20794107/answer/23330381" target="_blank" rel="noopener">https://www.zhihu.com/question/20794107/answer/23330381</a></p>
<p><a href="http://ifeve.com/jdk%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E4%BB%A3%E7%90%86%E4%B8%8Ecglib%E4%BB%A3%E7%90%86%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/" target="_blank" rel="noopener">http://ifeve.com/jdk%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E4%BB%A3%E7%90%86%E4%B8%8Ecglib%E4%BB%A3%E7%90%86%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/</a></p>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>More than your eyes can see</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/uploads/wechatpay.jpg" alt="一 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/uploads/alipay.jpg" alt="一 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/design-patterns/" rel="tag"># design patterns</a>
          
            <a href="/tags/java/" rel="tag"># java</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/05/30/Reactor-vs-Proactor/" rel="next" title="Reactor vs. Proactor">
                <i class="fa fa-chevron-left"></i> Reactor vs. Proactor
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/07/03/C-Primer阅读笔记二/" rel="prev" title="C++ Primer阅读笔记二">
                C++ Primer阅读笔记二 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/uploads/avatar.jpg"
                alt="一" />
            
              <p class="site-author-name" itemprop="name">一</p>
              <p class="site-description motion-element" itemprop="description">One more light goes out.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">33</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">18</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#代理模式"><span class="nav-number">1.</span> <span class="nav-text">代理模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#参与者"><span class="nav-number">1.1.</span> <span class="nav-text">参与者</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分类"><span class="nav-number">2.</span> <span class="nav-text">分类</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#静态代理"><span class="nav-number">2.1.</span> <span class="nav-text">静态代理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#动态代理"><span class="nav-number">2.2.</span> <span class="nav-text">动态代理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JDKProxy-vs-CGLIB"><span class="nav-number">2.3.</span> <span class="nav-text">JDKProxy vs. CGLIB</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Java-Proxy"><span class="nav-number">2.3.1.</span> <span class="nav-text">Java Proxy</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#CGLOB-Code-Generation-Library"><span class="nav-number">2.3.2.</span> <span class="nav-text">CGLOB(Code Generation Library)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#应用场景"><span class="nav-number">3.</span> <span class="nav-text">应用场景</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#常见情况"><span class="nav-number">3.1.</span> <span class="nav-text">常见情况</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#远程代理（Remote-Proxy）"><span class="nav-number">3.1.1.</span> <span class="nav-text">远程代理（Remote Proxy）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#虚代理（Virtual-Proxy）"><span class="nav-number">3.1.2.</span> <span class="nav-text">虚代理（Virtual Proxy）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#保护代理（Protection-Proxy）"><span class="nav-number">3.1.3.</span> <span class="nav-text">保护代理（Protection Proxy）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#智能指引（Smart-Reference）"><span class="nav-number">3.1.4.</span> <span class="nav-text">智能指引（Smart Reference）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#缓冲代理（Cache-Proxy）"><span class="nav-number">3.1.5.</span> <span class="nav-text">缓冲代理（Cache Proxy）</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Spring-AOP"><span class="nav-number">3.2.</span> <span class="nav-text">Spring AOP</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reference"><span class="nav-number">4.</span> <span class="nav-text">Reference</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">一</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a></div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://sinceq.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://sinceq.com/2017/06/24/代理模式/';
          this.page.identifier = '2017/06/24/代理模式/';
          this.page.title = '代理模式';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://sinceq.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  

















  





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
